<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>P5.js Server</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">P5.js Server</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#features">Features</a></li>
<li><a href="#usage">Usage</a>
<ul>
<li><a href="#creating-a-sketch">Creating a sketch</a></li>
<li><a href="#running-the-server">Running the server</a></li>
<li><a href="#building-a-static-site">Building a static site</a></li>
<li><a href="#converting-between-javascript-only-and-html-sketches">Converting between JavaScript-only and HTML sketches</a></li>
</ul></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#command-line-reference">Command-Line Reference</a>
<ul>
<li><a href="#p5-create-name"><code>p5 create [NAME]</code></a></li>
<li><a href="#p5-serve-filename"><code>p5 serve [filename]</code></a></li>
<li><a href="#p5-convert-filename---to-html-javascript"><code>p5 convert filename --to html | javascript</code></a></li>
</ul></li>
<li><a href="#implementation-notes">Implementation Notes</a></li>
<li><a href="#limitations">Limitations</a></li>
<li><a href="#api">API</a></li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
<li><a href="#license">License</a></li>
</ul>
</nav>
<p><a href="https://www.npmjs.com/package/p5-server"><img src="https://badge.fury.io/js/p5-server.svg" alt="npm version" /></a> <a href="https://github.com/osteele/p5-server/actions/workflows/ci.yml"><img src="https://github.com/osteele/p5-server/actions/workflows/ci.yml/badge.svg" alt="CI workflow" /></a></p>
<p><strong>p5-server</strong> is a command-line interface for <a href="https://p5js.org/">p5.js</a>. It provides a web server with live reload, that knows how to serve JavaScript-only sketches and figure out which libraries a sketch needs in order to run.</p>
<p>The command can also be used to create a set of HTML pages for browsing a collection of sketches. The <a href="https://osteele.github.io/p5.libs/p5.vector-arguments/examples">examples page</a> of the <a href="https://osteele.github.io/p5.libs/p5.vector-arguments">p5.vectorArguments</a> documentation demonstrates this.</p>
<p>The web server, library inference, and sketch generation features are also available as a <a href="https://github.com/osteele/vscode-p5server#readme">Visual Studio Code extension</a> and via a <a href="https://github.com/osteele/p5-server/tree/master/p5-analysis#readme">programmatic API</a>.</p>
<figure>
<img src="docs/screenshot.png" alt="Directory listing" /><figcaption aria-hidden="true">Directory listing</figcaption>
</figure>
<figure>
<img src="docs/split.png" alt="Split view" /><figcaption aria-hidden="true">Split view</figcaption>
</figure>
<h1 id="features">Features</h1>
<ul>
<li><strong>Live reload</strong>. The browser reloads the page when the source is modified.</li>
<li><strong>JavaScript-only sketches</strong>. Run a sketch that’s just a JavaScript file (e.g. <code>p5 serve sketch.js</code>). You don’t need to create an HTML file just to run the sketch.</li>
<li><strong>Automatic library includes</strong>. If a JavaScript-only sketch uses a function from a <a href="https://p5js.org/libraries/">p5.js library</a>, the library will be included. (<a href="https://github.com/osteele/p5-server/tree/master/p5-analysis#automatic-library-inclusion">This page</a> describes how this works.)</li>
<li><strong>In-Page syntax errors</strong>. If a JavaScript file has a syntax error, the browser page displays the error. <img src="docs/syntax-error.png" alt="Syntax error reported in browser" /> <img src="docs/syntax-error-split.png" alt="Syntax error reported in browser split-view" /></li>
<li><strong>P5-aware directory listings</strong>. Viewing a directory in the browser lists the sketches, folders, other files in that directory.</li>
<li><strong>Sketch generation</strong>. <code>p5 generate</code> creates a template sketch.</li>
</ul>
<h1 id="usage">Usage</h1>
<p>In a terminal window:</p>
<ul>
<li><code>p5 serve</code> starts a server in the current directory</li>
<li><code>p5 serve &lt;directory&gt;</code> serves a different directory.</li>
<li><code>p5 serve sketch.html</code> or <code>p5 serve sketch.js</code> serve a specific file.</li>
<li><code>p5 serve [directory] --open</code> opens the URL in the browser after starting the server.</li>
<li><code>p5 build [directory]</code> creates a static site that displays the sketches with a navigation sidebar.</li>
<li><code>p5 serve [directory] --theme split</code> uses the split-view theme.</li>
</ul>
<p><code>p5 serve</code> displays a URL that can be entered into a browser. (In some terminal programs, you can command-click on the URL instead of copying and pasting it.)</p>
<h2 id="creating-a-sketch">Creating a sketch</h2>
<p><code>p5 create</code> creates a JavaScript sketch file named <code>sketch.js</code> in the current directory.</p>
<p>This is a <strong>JavaScript-only sketch</strong>. The server can run this sketch, or you can paste it into online editors such as the <a href="https://editor.p5js.org">P5 web editor</a> and <a href="https://openprocessing.org">OpenProcessing.org</a>.</p>
<p><code>p5 create my-sketch.js</code> creates a JavaScript sketch file named <code>my-sketch.js</code>.</p>
<p><code>p5 create my-sketch.html</code> creates an HTML file named <code>my-sketch.html</code> and a JavaScript file named <code>my-sketch.js</code>.</p>
<p><code>p5 create my-sketch</code> creates a folder named <code>my-sketch</code>, and creates <code>index.html</code> and <code>sketch.js</code> files inside this folder.</p>
<p>The default generated script contains <code>setup()</code> and <code>draw()</code> functions. The <code>setup()</code> functions creates a canvas, and the <code>draw()</code> functions draws circles that follow the mouse. <code>--options</code> can be used to customize this script. See the reference, below.</p>
<h2 id="running-the-server">Running the server</h2>
<p><code>p5 server</code> starts a sketch-aware server. The server is set to serve files from the current directory.</p>
<p><code>p5 server DIR</code> starts a server that serves files from the directory at DIR.</p>
<p>By default, the server runs on port 3000. You can open it in a browser by visiting <a href="http://localhost:3000" class="uri">http://localhost:3000</a>. The <code>--open</code> option will do this automatically.</p>
<p>If another server is already running on port 3000, the server will choose another port.</p>
<h2 id="building-a-static-site">Building a static site</h2>
<p><code>p5 build DIR</code> builds a static site into <code>./build</code>.</p>
<p>Run <code>p5 build --help</code> for a list of options.</p>
<p>Two themes are supported, <code>--theme directory</code> and <code>--theme split</code>.</p>
<h2 id="converting-between-javascript-only-and-html-sketches">Converting between JavaScript-only and HTML sketches</h2>
<p><code>p5 convert sketch.html</code> converts an HTML sketch to a JavaScript-only sketch, by deleting the HTML file. It first inspects this file, to insure that the sketch contains only a single script file, and that all the information necessary to run the sketch is in the script.</p>
<p><code>p5 convert sketch.js</code> creates an HTML file that can be used to run the sketch.</p>
<h1 id="installation">Installation</h1>
<ol type="1">
<li><p>Install <a href="https://nodejs.org/">Node.js</a>.</p></li>
<li><p>In a terminal window, enter:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install p5-server</span></code></pre></div></li>
</ol>
<h1 id="command-line-reference">Command-Line Reference</h1>
<p>Run <code>p5 --help</code> to see a list of commands.</p>
<p>Run <code>p5 &lt;command&gt; --help</code> to see command-line options.</p>
<h2 id="p5-create-name"><code>p5 create [NAME]</code></h2>
<ul>
<li><code>p5 create</code> – creates <code>sketch.js</code></li>
<li><code>p5 create my-sketch.js</code> – creates just the JavaScript file</li>
<li><code>p5 create my-sketch.html</code> – creates <code>my-sketch.html</code> and <code>my-sketch.js</code></li>
<li><code>p5 create my-sketch --type folder</code> – creates a folder named <code>my-sketch</code>, that contains files <code>index.html</code> and <code>sketch.js</code>.</li>
</ul>
<p><code>p5 create --options comments,preload</code> specifies a comma-separated set of template options. The options are:</p>
<ul>
<li><code>comments</code> – include comments (e.g. <code>// put setup code here</code>) inside the functions</li>
<li><code>preload</code> – include an (empty) <code>preload()</code> function</li>
<li><code>windowResized</code> – include a <code>windowResized()</code> function, that resizes the canvas when the window is resized</li>
<li><code>no-draw</code> – omit the <code>draw()</code> function, in order to create a “static” sketch</li>
<li><code>no-examples</code> – omit the example call inside of <code>draw()</code></li>
</ul>
<h2 id="p5-serve-filename"><code>p5 serve [filename]</code></h2>
<p>Runs a web server that serves the current directory (if there is no argument), or the <code>filename</code> subdirectory of the current directory.</p>
<p><code>p5 serve filename</code> runs a sketch in the browser.</p>
<ul>
<li>If <code>filename</code> is an HTML file (for example, <code>index.html</code>), this command serves that page.</li>
<li>If <code>filename</code> is a JavaScript file that contains a p5.js sketch (for example, <code>sketch.js</code>), the server serves a page that runs the sketch.</li>
<li>If <code>filename</code> is a directory, the browser displays a list of sketches and files in that directory.</li>
<li>If <code>filename</code> is not supplied, the browser displays sketches and files in the current directory. (This is the same as <code>p5 serve .</code>.)</li>
</ul>
<h2 id="p5-convert-filename---to-html-javascript"><code>p5 convert filename --to html | javascript</code></h2>
<p>Converts between HTML and JavaScript-only sketches.</p>
<p>Converting a JavaScript-only sketch is simple. An HTML file with the same base name is created. This will only fail if the directory already contains a HTML file with this name.</p>
<p>Converting an HTML sketch to a JavaScript-only sketch involves deleting the HTML file that includes the script. This potentially looses some information. Before the file is deleted, the following checks are made:</p>
<ul>
<li>The HTML file should include only a single script file.</li>
<li>The libraries that the HTML file includes (via <code>&lt;script&gt;</code> tags) should be the same as the libraries that will be inferred from the script file. (See “Library inference”, below.)</li>
</ul>
<h1 id="implementation-notes">Implementation Notes</h1>
<p>The <a href="./p5-analysis/README.md#implementation-notes">p5-analysis implementation notes</a> describe sketch detection, automatic library inclusion, and other details of the implementation.</p>
<h1 id="limitations">Limitations</h1>
<ul>
<li>This code hasn’t been tested on Windows.</li>
<li>Generated sketches require an internet connection to run. They load the p5.js and other libraries from a content delivery network (“CDN”). Browsers cache these files, so reloading a page or running other sketches that use the same (or no) libraries do not require additional internet access, but you will need internet access the first time you use this extension or after the browser cache has expired.</li>
<li>The server requires an internet connection in order to display sketches and directory listings. (It loads the Semantic UI CSS framework from a CDN.)</li>
<li>This code hasn’t been tested with <a href="https://github.com/processing/p5.js/wiki/Global-and-instance-mode">instance-mode</a> sketches.</li>
<li>Library inference hasn’t been tested with sketches that are written as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">modules</a>.</li>
<li>See the <a href="./p5-analysis/README.md#implementation-notes">p5-analysis implementation notes</a> notes for limitations on the recognition of associated files.</li>
</ul>
<h1 id="api">API</h1>
<p>The server can be invoked programmatically. See the <a href="https://osteele.github.io/p5-server/p5-analysis/">API Reference</a> for installation instructions and reference documentation for this use.</p>
<h1 id="acknowledgements">Acknowledgements</h1>
<p>This project builds on these libraries and frameworks:</p>
<ul>
<li>commander, for parsing command-line arguments</li>
<li>esprima and node-html-parser for parsing JavaScript and HTML, respectively</li>
<li>expressjs for the web server</li>
<li>livereload for the live reload functionality</li>
<li>marked for converting Markdown to HTML</li>
<li>nunjucks and pug for template generation</li>
<li>The Semantic UI CSS framework</li>
</ul>
<h1 id="license">License</h1>
<p><a href="LICENSE">MIT</a> © by Oliver Steele</p>
</body>
</html>
